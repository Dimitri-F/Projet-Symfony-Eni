{% extends 'base.html.twig' %}

{% block title %}Création d'une sortie{% endblock %}

{% block body %}
    <h1 class="text-4xl mb-8 text-center">Création d'une sortie</h1>
    <div class="flex justify-center mt-8">
        <div class="grid grid-cols-2 gap-8">
            <div>
                {{ form_start(activityForm, {'attr' : {'id' : 'activity_form'}}) }}
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.nom) }}
                    {{ form_widget(activityForm.nom, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.nom) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.dateDebut) }}
                    {{ form_widget(activityForm.dateDebut) }}
                    {{ form_errors(activityForm.dateDebut) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.dateCloture) }}
                    {{ form_widget(activityForm.dateCloture) }}
                    {{ form_errors(activityForm.dateCloture) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.nbInscriptionsMax) }}
                    {{ form_widget(activityForm.nbInscriptionsMax, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.nbInscriptionsMax) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.duree) }}
                    {{ form_widget(activityForm.duree, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.duree) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.descriptionInfos) }}
                    {{ form_widget(activityForm.descriptionInfos, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.descriptionInfos) }}
                </div>
            </div>
            <div class="ml-12">
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.site) }}
                    {{ form_widget(activityForm.site, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.site) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.ville) }}
                    {{ form_widget(activityForm.ville, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.ville) }}
                </div>
                <div class="flex items-center">
                    <div class="mt-3 flex flex-col">
                        {{ form_label(activityForm.lieu) }}
                        <div class="flex items-center">
                            {{ form_widget(activityForm.lieu, {'attr': {'class': 'border'}}) }}
                            <a href="{{ path('app_create_lieu') }}"><img src="{{ asset('assets/img/add-button-lieu.png') }}" alt="ajout d'un lieu" class="w-8 h-8 ml-2"></a>
                        </div>
                        {{ form_errors(activityForm.lieu) }}
                    </div>
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.rue) }}
                    {{ form_widget(activityForm.rue, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.rue) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.codePostal) }}
                    {{ form_widget(activityForm.codePostal, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.codePostal) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.latitude) }}
                    {{ form_widget(activityForm.latitude, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.latitude) }}
                </div>
                <div class="mt-3 flex flex-col">
                    {{ form_label(activityForm.longitude) }}
                    {{ form_widget(activityForm.longitude, {'attr': {'class': 'border'}}) }}
                    {{ form_errors(activityForm.longitude) }}
                </div>
            </div>
            </div>
    </div>
    <div class="mt-6 flex justify-center">
        <button type="submit" name="save" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Enregistrer
        </button>
        <button type="submit" name="publish" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-4">
            Publier
        </button>
        <a href="{{ path('app_home') }}" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded ml-4">
            Annuler
        </a>
    </div>
    {{ form_end(activityForm) }}
{% endblock %}
{% block javascripts %}
    <script>
        window.onload = () => {
            let ville = document.querySelector("#create_activity_ville");
            ville.addEventListener("change", function (){
                let form = document.querySelector("#activity_form");
                let data = this.name + "=" + this.value;

                fetch(form.action,{
                    method : form.getAttribute("method"),
                    body : data,
                    headers : {
                        "Content-Type" : "application/x-www-form-urlencoded;charset:UTF-8"}
                })
                    .then(response => response.text())
                    .then(html => {
                        let content  = document.createElement("html");
                        content.innerHTML = html;
                        let newSelect = content.querySelector("#create_activity_lieu");
                        document.querySelector("#create_activity_lieu").replaceWith(newSelect);
                        console.log(newSelect)
                    })
                    .catch(error => {
                        console.log(error)
                    })
            });
        }
    </script>
{% endblock %}
